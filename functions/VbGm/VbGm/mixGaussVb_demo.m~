%% Variational Bayesian for Gaussian Mixture Model
close all; clear;
d = 2;
k = 2;
n = 5000;
%[X,z] = mixGaussRnd(d,k,n);
X1 = mvnrnd([0 0], [2 -1; -1 1], n/2);
X2 = mvnrnd([3 3], [5 1; 1 5], n/2);
X = [X1;X2]';
z = [ones(1,n/2) 2*ones(1,n/2)]';

true_prob = mvnpdf(

%scatter(X(:,1),X(:,2))
plotClass(X,z);
m = floor(n/2);
X1 = X(:,1:m);
X2 = X(:,(m+1):end);
axis xy
axis equal
%% VB fitting
[y1, model, L] = mixGaussVb(X,2);
figure;
plotClass(X,y1);
figure;
plot(L)
%% Predict testing data
% [y2, R] = mixGaussVbPred(model,X2);
% figure;
% plotClass(X2,y2);

%% jenn testing
xs = -10:1:10; ys = -9:1:9;
[Xs,Ys] = meshgrid(xs,ys);
x_hat = [Xs(:) Ys(:)];
[prob, cov_mat] = get_mgvb_density(model,x_hat);
prob = reshape(prob,length(ys),length(xs));

figure
h = scatter(X(1,:),X(2,:),'.');
hold on
contour(Xs,Ys,prob,'k', 'LineWidth', 5)
axis equal
axis xy
title('{\bf Scatter Plot and Fitted Gaussian Mixture Contours}')


hold on
contour(
